/* 
    DESARROLLADO POR: CÉSAR MARTÍNEZ. https://www.linkedin.com/in/c%C3%A9sar-mart%C3%ADnez-b8a53326a/
    GESTOR DE BASE DE DATOS UTILIZADO: ORACLE DATABASE - PL/SQL.
    VERSIÓN DEL GESTOR DE BASE DE DATOS UTILIZADO: ORACLE XE 21C.
    SISTEMA INFORMÁTICO DISEÑADO: SISTEMA DE BANCA.
    MODELO DE NEGOCIO: MODELO DE NEGOCIO CAPITAL, ENFOCADO AL PLAN DE PAGO TEÓRICO.
    TIPO DE SISTEMA: PROTOTIPO EN DESARROLLO Y MEJORA.
*/

--1
CREATE TABLE TB_TIPO_CLIENTE(
    ID_TP_CLIENTE      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION     DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION      VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION DATE NULL,
    MODIFICADO_POR     VARCHAR2(50) NULL,
    
    CLIENTE            VARCHAR2(20) NOT NULL,
    ESTADO             NUMBER(1) DEFAULT 1,

    CONSTRAINT PK_TP_CLIENTE PRIMARY KEY(ID_TP_CLIENTE),
    CONSTRAINT UQ_TP_CLIENTE UNIQUE (CLIENTE)
);

--2
CREATE TABLE TB_PAISES(
    ID_PAIS            NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION     DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION      VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION DATE NULL,
    MODIFICADO_POR     VARCHAR2(50) NULL,
    
    NOM_PAIS           VARCHAR2(20) NOT NULL,
    CODIGO_PAIS        VARCHAR2(10) NOT NULL, -- +503, +52 ... ETC
    ESTADO             NUMBER(1) DEFAULT 1,
    
    CONSTRAINT PK_PAIS PRIMARY KEY(ID_PAIS),
    CONSTRAINT UQ_PAIS UNIQUE     (NOM_PAIS)
);

--3
CREATE TABLE TB_TIPO_IDENTIFICACION(
    ID_IDENTIFICACION      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    NOM_IDENTIFICACION     VARCHAR2(20) NOT NULL,
    ESTADO                 NUMBER(1) DEFAULT 1,
    
    CONSTRAINT PK_IDENTIFICACION PRIMARY KEY(ID_IDENTIFICACION),
    CONSTRAINT UQ_IDENTIFICACION UNIQUE     (NOM_IDENTIFICACION)
);

--4
CREATE TABLE TB_ESTADOS_CIVILES(
    ID_ESTADO_CIVIL        NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    NOM_ESTADO_CIVIL       VARCHAR(15) NOT NULL,
    ESTADO                 NUMBER(1) DEFAULT 1,
    
    CONSTRAINT PK_ESTADO_CIVIL PRIMARY KEY(ID_ESTADO_CIVIL),
    CONSTRAINT UQ_ESTADO_CIVIL UNIQUE     (NOM_ESTADO_CIVIL)
);

--5
CREATE TABLE TB_MONEDAS(
    ID_MONEDA              NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    NOM_MONEDA             VARCHAR2(25) NOT NULL,
    ESTADO                 NUMBER(1) DEFAULT 1,
    
    CONSTRAINT PK_ID_MONEDA PRIMARY KEY(ID_MONEDA),
    CONSTRAINT UQ_MONEDA    UNIQUE(NOM_MONEDA)
);

--6
CREATE TABLE TB_RANGO_INGRESO(
    ID_RANGO_INGRESO       NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    ID_MONEDA              NUMBER NOT NULL,
    RANGO                  VARCHAR(100) NOT NULL,
    ESTADO                 NUMBER(1) DEFAULT 1,
    
    CONSTRAINT PK_RANGO_INGRESO PRIMARY KEY(ID_RANGO_INGRESO),
    CONSTRAINT FK_RANGO#MONEDA FOREIGN KEY (ID_MONEDA) REFERENCES TB_MONEDAS(ID_MONEDA),
    CONSTRAINT UQ_RANGO         UNIQUE     (RANGO),
    CONSTRAINT CHK_RANGO        CHECK (REGEXP_LIKE(RANGO, '^[0-9\-]+$'))
);

--7
CREATE TABLE TB_DEPARTAMENTOS(
    ID_DEPTO               NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    DEPARTAMENTO           VARCHAR2(40) NOT NULL,
    ESTADO                 NUMBER(1,0)  DEFAULT 1,
    
    CONSTRAINT PK_DEPTO PRIMARY KEY (ID_DEPTO),
    CONSTRAINT UQ_NOM#DEPTO UNIQUE (DEPARTAMENTO)
);

--8
CREATE TABLE TB_TIPO_SUCURSAL(
    ID_TP_SUCURSAL         NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    TIPO_SUCURSAL          VARCHAR2(40) NOT NULL,
    ESTADO                 NUMBER(1,0)  DEFAULT 1,
    
    CONSTRAINT PK_TP_SUCURSAL   PRIMARY KEY       (ID_TP_SUCURSAL),
    CONSTRAINT UQ_TIPO#SUCURSAL UNIQUE            (TIPO_SUCURSAL)
);

--9
CREATE TABLE TB_SUCURSAL(
    ID_SUCURSAL            NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    ID_TP_SUCURSAL         NUMBER NOT NULL,
    
    CODIGO_SUCURSAL        VARCHAR2(12) DEFAULT SUBSTR(SYS_GUID(), 1, 12),
    DIRECCION              VARCHAR2(100) NOT NULL,
    ESTADO                 NUMBER(1,0)  DEFAULT 1,
    
    CONSTRAINT PK_SUCURSAL           PRIMARY KEY       (ID_SUCURSAL),
    CONSTRAINT FK_TP#SUCURSAL        FOREIGN KEY       (ID_TP_SUCURSAL) REFERENCES TB_TIPO_SUCURSAL(ID_TP_SUCURSAL),
    CONSTRAINT UQ_DIRECCION#SUCURSAL UNIQUE            (DIRECCION)
);

--10
CREATE TABLE TB_SUCURSAL_DEPTO(
    ID_DEPTO       NUMBER NOT NULL,
    ID_SUCURSAL    NUMBER NOT NULL,
    FECHA_CREACION DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION  VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION DATE NULL,
    
    CONSTRAINT PK_SUCURSAL#DEPTO PRIMARY KEY (ID_SUCURSAL,ID_DEPTO),
    CONSTRAINT FK_UNIDAD#DEPTOS FOREIGN KEY (ID_SUCURSAL) REFERENCES TB_SUCURSAL(ID_SUCURSAL),
    CONSTRAINT FK_DEPTO#DEPTO FOREIGN KEY (ID_DEPTO) REFERENCES TB_DEPARTAMENTOS(ID_DEPTO)
);

--11
CREATE TABLE TB_CARGO_EMPLEADO(
    ID_CARGO_EMPLEADO      NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    NOM_CARGO              VARCHAR2(40) NOT NULL,
    ESTADO                 NUMBER(1,0)  DEFAULT 1,
    
    CONSTRAINT PK_CARGO_EMPLEADO PRIMARY KEY       (ID_CARGO_EMPLEADO),
    CONSTRAINT UQ_NOM#CARGO      UNIQUE            (NOM_CARGO)
);

--12
CREATE TABLE TB_PERSONAS(
   ID_PERSONA             NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION     DATE NULL,
   MODIFICADO_POR         VARCHAR2(50) NULL,
   
   ID_TP_CLIENTE          NUMBER NULL,
   ID_IDENTIFICACION      NUMBER NOT NULL,
   ID_PAIS                NUMBER NOT NULL,
   ID_ESTADO_CIVIL        NUMBER NOT NULL,
   ID_RANGO_INGRESO       NUMBER NOT NULL,
   ID_MONEDA              NUMBER NOT NULL,
   ID_SUCURSAL            NUMBER NULL,
   ID_DEPTO               NUMBER NULL,
   
   NOMBRE                 VARCHAR2(20) NOT NULL,
   APE_PATE               VARCHAR2(15) NOT NULL,
   APE_MATE               VARCHAR2(15) NOT NULL,
   FECHA_NAC              DATE         NOT NULL,
   DIRECCION_RES          VARCHAR2(60) NOT NULL,
   TEL_CEL                VARCHAR2(31) NOT NULL,
   TEL_FIJO               VARCHAR2(31) NOT NULL,
   CORREO_ELECTRONICO     VARCHAR2(80) NOT NULL,
   SEXO                   NUMBER(1,0)  NOT NULL, --1 Masculono y 0 Femenino
   NUM_IDENTIFICACION     VARCHAR2(20) NOT NULL,
   FECHA_EXPIRACION_IDE   DATE         NOT NULL,
   CARGO_TRABAJO          VARCHAR2(100) NULL,
   
   EMPLEADO               NUMBER(1,0)  NOT NULL,
   ESTADO                 NUMBER(1,0)  DEFAULT 1,
   
   CONSTRAINT PK_PERSONA           PRIMARY KEY (ID_PERSONA),
   CONSTRAINT FK_CLIEN#TP_CLIENTE  FOREIGN KEY (ID_TP_CLIENTE) REFERENCES TB_TIPO_CLIENTE(ID_TP_CLIENTE),
   CONSTRAINT FK_CLIEN#PAIS_IDENTIFICACION FOREIGN KEY (ID_IDENTIFICACION) REFERENCES TB_TIPO_IDENTIFICACION(ID_IDENTIFICACION),
   CONSTRAINT FK_CLIEN#PAIS_NAC    FOREIGN KEY (ID_PAIS)       REFERENCES TB_PAISES(ID_PAIS),
   CONSTRAINT FK_CLIEN#ESTA_CIVIL  FOREIGN KEY (ID_ESTADO_CIVIL) REFERENCES TB_ESTADOS_CIVILES(ID_ESTADO_CIVIL),
   CONSTRAINT FK_CLIEN#RNAG_INGRE  FOREIGN KEY (ID_RANGO_INGRESO) REFERENCES TB_RANGO_INGRESO(ID_RANGO_INGRESO),
   CONSTRAINT FK_CLIEN#MONEDA      FOREIGN KEY (ID_MONEDA)     REFERENCES TB_MONEDAS(ID_MONEDA),
   CONSTRAINT FK_CLIEN#SUCURSAL    FOREIGN KEY (ID_SUCURSAL)   REFERENCES TB_SUCURSAL(ID_SUCURSAL),
   CONSTRAINT FK_PERSONA#DEPTO FOREIGN KEY (ID_DEPTO) REFERENCES TB_DEPARTAMENTOS(ID_DEPTO),
   CONSTRAINT UQ_NOM#CLIENTE       UNIQUE      (NOMBRE, APE_PATE, APE_MATE)
);

--13
CREATE TABLE TB_USUARIO(
    ID_USER                NUMBER GENERATED BY DEFAULT AS IDENTITY,
    FECHA_CREACION         DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
    HORA_CREACION          VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
    FECHA_MODIFICACION     DATE NULL,
    MODIFICADO_POR         VARCHAR2(50) NULL,
    
    ID_SUCURSAL            NUMBER NOT NULL,
    ID_CARGO_EMPLEADO      NUMBER NOT NULL,
    ID_PERSONA             NUMBER NOT NULL,
    
    USUARIO                VARCHAR2(20) NOT NULL,
    CONTRASEÑA             VARCHAR2(40) NOT NULL,
    
    ADMINISTRADOR          NUMBER(1,0)  NOT NULL,
    PRESTAMOS              NUMBER(1,0)  NOT NULL,
    CUENTAS                NUMBER(1,0)  NOT NULL,
    TARJETAS               NUMBER(1,0)  NOT NULL,
    
    ESTADO                 NUMBER(1,0)  DEFAULT 1,
    
    CONSTRAINT PK_USUARIO         PRIMARY KEY (ID_USER),
    CONSTRAINT FK_USUA#SUCURSAL   FOREIGN KEY (ID_SUCURSAL)       REFERENCES TB_SUCURSAL(ID_SUCURSAL) ON DELETE CASCADE,
    CONSTRAINT FK_USUA#CARGO      FOREIGN KEY (ID_CARGO_EMPLEADO) REFERENCES TB_CARGO_EMPLEADO(ID_CARGO_EMPLEADO) ON DELETE CASCADE,
    CONSTRAINT FK_USUA#PERSONA    FOREIGN KEY (ID_PERSONA)        REFERENCES TB_PERSONAS(ID_PERSONA) ON DELETE CASCADE,
    CONSTRAINT UQ_USUA#CONTRASEÑA UNIQUE      (USUARIO,CONTRASEÑA)
);

--14
CREATE TABLE TB_TIPO_PRODUCTO(
   ID_TIPO_PRODUCTO    NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   NOM_SERVICIO        VARCHAR2(20) NOT NULL,
   ESTADO              NUMBER(1,0)  DEFAULT 1,

   CONSTRAINT PK_TP_PRODUCTO  PRIMARY KEY (ID_TIPO_PRODUCTO),
   CONSTRAINT UQ_NOM_SERVICIO UNIQUE      (NOM_SERVICIO)
);

--15
CREATE TABLE TB_PRODUCTO_APLICACION(
   ID_TIPO_APLICACION  NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_TIPO_PRODUCTO    NUMBER NOT NULL,
   ID_MONEDA           NUMBER NOT NULL,
   
   NOM_PRODUCTO        VARCHAR2(60) NOT NULL,
   ESTADO              NUMBER(1,0)  DEFAULT 1,

   CONSTRAINT PK_PROD_APLICACION PRIMARY KEY (ID_TIPO_APLICACION),
   CONSTRAINT FK_PROD_TIPO#PRODUCTO FOREIGN KEY (ID_TIPO_PRODUCTO) REFERENCES TB_TIPO_PRODUCTO(ID_TIPO_PRODUCTO),
   CONSTRAINT FK_PROD_APLI#MONEDA FOREIGN KEY (ID_MONEDA) REFERENCES TB_MONEDAS(ID_MONEDA),
   CONSTRAINT UQ_NOM#APLIC UNIQUE     (NOM_PRODUCTO)
);

--16
CREATE TABLE TB_CUENTA(
   ID_CUENTA           NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_TIPO_APLICACION  NUMBER NOT NULL,
   ID_PERSONA          NUMBER NOT NULL,
   ID_SUCURSAL         NUMBER NOT NULL,
   
   CODIGO_CUENTA       VARCHAR2(12) DEFAULT SUBSTR(SYS_GUID(), 1, 12),
   SALDO_APERTURA      NUMBER(18,2) DEFAULT 0.00,
   SALDO_CUENTA        NUMBER(18,2) DEFAULT 0.00,
   SALDO_CONGELADO     NUMBER(18,2) DEFAULT 0.00,
   FECHA_CANCELACION   DATE NULL,
   ESTADO              NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_ID_CUENTA          PRIMARY KEY (ID_CUENTA),
   CONSTRAINT FK_CUENTA#TIPO_CUENTA FOREIGN KEY (ID_TIPO_APLICACION) REFERENCES TB_PRODUCTO_APLICACION(ID_TIPO_APLICACION),
   CONSTRAINT FK_CUENTA#PERSONA     FOREIGN KEY (ID_PERSONA)     REFERENCES TB_PERSONAS(ID_PERSONA) ON DELETE CASCADE,
   CONSTRAINT FK_CUENTA#SUCURSAL    FOREIGN KEY (ID_SUCURSAL)    REFERENCES TB_SUCURSAL(ID_SUCURSAL)
);

--17
CREATE TABLE TB_TIPO_TARJETA(
   ID_TIPO_TARJETA      NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION       DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION        VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION   DATE NULL,
   MODIFICADO_POR       VARCHAR2(50) NULL,
   NOM_TARJETA          VARCHAR2(20) NOT NULL,
   ESTADO               NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_ID_TARJ PRIMARY KEY (ID_TIPO_TARJETA),
   CONSTRAINT UQ_TP_TARJETA UNIQUE   (NOM_TARJETA)
);

--18
CREATE TABLE TB_TARJETA(
   ID_TARJETA          NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_PERSONA          NUMBER NOT NULL,
   ID_CUENTA           NUMBER NOT NULL,
   ID_TIPO_TARJETA     NUMBER NOT NULL,
   
   CODIGO_TARJETA      VARCHAR2(12) DEFAULT SUBSTR(SYS_GUID(), 1, 12),
   SALDO               NUMBER(18,2) DEFAULT 0.00,
   LIMITE              NUMBER(18,2) DEFAULT 0.00,
   ESTADO              NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_TARJETA PRIMARY KEY (ID_TARJETA),
   CONSTRAINT FK_TARJETA#PERSONA FOREIGN KEY (ID_PERSONA)    REFERENCES TB_PERSONAS (ID_PERSONA),
   CONSTRAINT FK_TARJETA#CUENTA FOREIGN KEY (ID_CUENTA)      REFERENCES TB_CUENTA (ID_CUENTA) ON DELETE CASCADE,
   CONSTRAINT FK_TP_TARJETA#CRED FOREIGN KEY (ID_TIPO_TARJETA) REFERENCES TB_TIPO_TARJETA (ID_TIPO_TARJETA)
);

--19
CREATE TABLE TB_PRESTAMO (
  ID_PRESTAMO        NUMBER GENERATED BY DEFAULT AS IDENTITY,
  FECHA_CREACION     DATE DEFAULT SYSDATE NOT NULL,
  HORA_CREACION      VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
  FECHA_MODIFICACION DATE NULL,
  MODIFICADO_POR     VARCHAR2(50),

  ID_PERSONA         NUMBER NOT NULL,
  ID_CUENTA          NUMBER NOT NULL,
  ID_TIPO_APLICACION NUMBER NOT NULL,

  MONTO_OTORGADO     NUMBER(18,2) DEFAULT 0.00, --EJ. 10,200.00
  TASA_INTERES       NUMBER(8,2) DEFAULT 0.00, --EJ. 0.01 --(TASA_ANUAL/100) /((360 * 12 ) / 365)
  PLAZO              NUMBER, --EJ. 12.00 -PLAZO
  TASA_EFECTIVA      NUMBER(8,2), --EJ. 0.01
  CUOTA              NUMBER(8,2) NOT NULL, --MONTO DE CUOTA -MONTO_OTORGADO/((1 - (1 + TASA_EFECTIVA) ^ - NUM_CUOTAS) / TASA_EFECTIVA)
  
  FECHA_VENCIMIENTO  DATE NOT NULL, --ULTIMO MES DE PAGO
  FRECUENCIA_PAGO    VARCHAR2(50) NOT NULL, --¿QUE SE ALMACENARIA EN ESTE CAMPO?
  SALDO_INTERES      NUMBER(8,2) DEFAULT 0.00,
  SALDO_CAPITAL      NUMBER(8,2) DEFAULT 0.00,
  DIAS_ATRASO        NUMBER NOT NULL,
  SALDO_MORA         NUMBER(8,2) DEFAULT 0.00, --
  CODIGO_PRESTAMO    VARCHAR2(12) DEFAULT SUBSTR(SYS_GUID(), 1, 12),

  ESTADO             NUMBER(1,0) DEFAULT 1,

  CONSTRAINT PK_PRESTAMO PRIMARY KEY (ID_PRESTAMO),
  CONSTRAINT FK_PREST_PERSONA FOREIGN KEY (ID_PERSONA) REFERENCES TB_PERSONAS (ID_PERSONA),
  CONSTRAINT FK_PREST_CUENTA FOREIGN KEY (ID_CUENTA) REFERENCES TB_CUENTA (ID_CUENTA),
  CONSTRAINT FK_PREST_PROD_APLIC FOREIGN KEY (ID_TIPO_APLICACION) REFERENCES TB_PRODUCTO_APLICACION (ID_TIPO_APLICACION)
);

--20
CREATE TABLE TB_PLAN_PAGO(
   ID_PLAN_PAGO         NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION       DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION        VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION   DATE NULL,
   MODIFICADO_POR       VARCHAR2(50) NULL,
   
   ID_PRESTAMO          NUMBER NOT NULL,
   
   FECHA_PAGADA         DATE NOT NULL,
   FECHA_CUOTA          DATE NOT NULL,
   CAPITAL              NUMBER(18,2) DEFAULT 0.00,
   CAPITAL_PAGADO       NUMBER(18,2) DEFAULT 0.00,
   INTERES              NUMBER(18,2) DEFAULT 0.00,
   INTERES_PAGADO       NUMBER(18,2) DEFAULT 0.00,
   NUM_CUOTAS           NUMBER NOT NULL,
   MORA                 NUMBER(18,2) DEFAULT 0.00,
   MORA_PAGADA          NUMBER(18,2) DEFAULT 0.00,
   EXTRA                NUMBER(18,2) DEFAULT 0.00,
   
   ESTADO               NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_PLAN#PAGO   PRIMARY KEY (ID_PLAN_PAGO, FECHA_CREACION),
   CONSTRAINT FK_PLAN#PRESTAMO FOREIGN KEY (ID_PRESTAMO) REFERENCES TB_PRESTAMO(ID_PRESTAMO)
);

--21
CREATE TABLE TB_TRANSACCION(
   ID_TRANSACCION     NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION     DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION      VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION DATE NULL,
   MODIFICADO_POR     VARCHAR2(50) NULL,
   
   ID_TIPO_PRODUCTO   NUMBER NOT NULL,
   
   TIPO_TRANSACCION   VARCHAR2(30) NOT NULL,
   NOM_TRANSACCION    VARCHAR2(30) NOT NULL,
   ESTADO             NUMBER(1,0) DEFAULT 1,
   
   CONSTRAINT PK_TRANSACCION PRIMARY KEY (ID_TRANSACCION),
   CONSTRAINT FK_TIPO_TRANSAC#TIPO_PRODU FOREIGN KEY (ID_TIPO_PRODUCTO) REFERENCES TB_TIPO_PRODUCTO(ID_TIPO_PRODUCTO),
   CONSTRAINT UQ_TIPO#TRANSACCION UNIQUE (TIPO_TRANSACCION,NOM_TRANSACCION)
);

--22
CREATE TABLE TB_MOVIMIENTO_ABONO(
   ID_MV_ABONO         NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_CUENTA           NUMBER NOT NULL,
   ID_PRESTAMO         NUMBER NOT NULL,
   ID_USER             NUMBER NOT NULL,--ALMACENARA EL NOMBRE DEL USUARIO/EMPLEADO DE LA SESION EN QUE SE HIZO LA TRANSACCION EN LA APLICACION
   ID_PERSONA          NUMBER NOT NULL,
   ID_SUCURSAL         NUMBER NOT NULL,
   ID_TRANSACCION      NUMBER NOT NULL,
   
   CODIGO_TRANSACCION  VARCHAR2(12) DEFAULT SUBSTR(SYS_GUID(), 1, 12),
   DESCRIPCION         VARCHAR2(50) NOT NULL,
   TOTAL_PAGADO        NUMBER(18,2) DEFAULT 0.00,
   CAPITAL_PAGADO      NUMBER(18,2) DEFAULT 0.00,
   INTERES_PAGADO      NUMBER(18,2) DEFAULT 0.00,
   MORA_PAGADA         NUMBER(18,2) DEFAULT 0.00,
   ESTADO              NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_MV_ABONO PRIMARY KEY (ID_MV_ABONO),
   CONSTRAINT FK_MV_ABONO#CUENTA FOREIGN KEY (ID_CUENTA) REFERENCES TB_CUENTA (ID_CUENTA),
   CONSTRAINT FK_MV_ABONO#PRESTAMO FOREIGN KEY (ID_PRESTAMO) REFERENCES TB_PRESTAMO (ID_PRESTAMO),
   CONSTRAINT FK_MV_ABONO#USER FOREIGN KEY (ID_USER) REFERENCES TB_USUARIO (ID_USER),
   CONSTRAINT FK_MV_ABONO#PERSONA FOREIGN KEY (ID_PERSONA) REFERENCES TB_PERSONAS (ID_PERSONA),
   CONSTRAINT FK_MV_ABONO#SUCURSAL FOREIGN KEY (ID_SUCURSAL) REFERENCES TB_SUCURSAL (ID_SUCURSAL),
   CONSTRAINT FK_MV_ABONO#TRANSACCION FOREIGN KEY (ID_TRANSACCION) REFERENCES TB_TRANSACCION (ID_TRANSACCION)
);

--23
CREATE TABLE TB_MOVIMIENTO_CUENTA(
   ID_MV_CUENTA        NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_CUENTA           NUMBER NOT NULL,
   ID_USER             NUMBER NOT NULL,--ALMACENARA EL NOMBRE DEL USUARIO/EMPLEADO DE LA SESION EN QUE SE HIZO LA TRANSACCION EN LA APLICACION
   ID_PERSONA          NUMBER NOT NULL,
   ID_SUCURSAL         NUMBER NOT NULL,
   ID_TRANSACCION      NUMBER NOT NULL,
   
   DESCRIPCION         VARCHAR2(50) NOT NULL,
   MONTO               NUMBER(18,2) DEFAULT 0.00,
   ESTADO              NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_MV_CUENTA PRIMARY KEY (ID_MV_CUENTA),
   CONSTRAINT FK_MvCuenta#CUENTA FOREIGN KEY (ID_CUENTA) REFERENCES TB_CUENTA  (ID_CUENTA),
   CONSTRAINT FK_MvCuenta#USUARIO FOREIGN KEY (ID_USER)  REFERENCES TB_USUARIO (ID_USER),
   CONSTRAINT FK_MvCuenta#PERSONA FOREIGN KEY (ID_PERSONA)   REFERENCES TB_PERSONAS (ID_PERSONA),
   CONSTRAINT FK_MvCuenta#SUCURSAL FOREIGN KEY (ID_SUCURSAL) REFERENCES TB_SUCURSAL (ID_SUCURSAL),
   CONSTRAINT FK_MvCuenta#TRANSACCION FOREIGN KEY (ID_TRANSACCION) REFERENCES TB_TRANSACCION (ID_TRANSACCION)
);

--24
CREATE TABLE TB_MOVIMIENTO_TARJETA(
   ID_MV_TARJETA       NUMBER GENERATED BY DEFAULT AS IDENTITY,
   FECHA_CREACION      DATE DEFAULT SYSDATE NOT NULL, --DATE ES UN TIPO DE DATO Y SYSDATE ES UNA FUNCION
   HORA_CREACION       VARCHAR2(8) DEFAULT TO_CHAR(SYSDATE, 'HH24:MI:SS') NOT NULL,
   FECHA_MODIFICACION  DATE NULL,
   MODIFICADO_POR      VARCHAR2(50) NULL,
   
   ID_TARJETA          NUMBER NOT NULL,
   ID_USER             NUMBER NOT NULL,--ALMACENARA EL NOMBRE DEL USUARIO/EMPLEADO DE LA SESION EN QUE SE HIZO LA TRANSACCION EN LA APLICACION
   ID_SUCURSAL         NUMBER NOT NULL,
   ID_PERSONA          NUMBER NOT NULL,
   ID_PRESTAMO         NUMBER NOT NULL,
   ID_TRANSACCION      NUMBER NOT NULL,
   
   DESCRIPCION         VARCHAR2(50) NOT NULL,
   MONTO               NUMBER(18,2) DEFAULT 0.00,
   ESTADO              NUMBER(1,0) DEFAULT 1,

   CONSTRAINT PK_MV_TARJETA PRIMARY KEY (ID_MV_TARJETA),
   CONSTRAINT FK_MvTarjeta#TARJETA  FOREIGN KEY (ID_TARJETA) REFERENCES TB_TARJETA (ID_TARJETA),
   CONSTRAINT FK_MvTarjeta#USER     FOREIGN KEY (ID_USER) REFERENCES TB_USUARIO (ID_USER),
   CONSTRAINT FK_MvTarjeta#SUCURSAL FOREIGN KEY (ID_SUCURSAL) REFERENCES TB_SUCURSAL (ID_SUCURSAL),
   CONSTRAINT FK_MvTarjeta#PERSONA     FOREIGN KEY (ID_PERSONA) REFERENCES TB_PERSONAS (ID_PERSONA),
   CONSTRAINT FK_MvTarjeta#PRESTAMO    FOREIGN KEY (ID_PRESTAMO) REFERENCES TB_PRESTAMO (ID_PRESTAMO),
   CONSTRAINT FK_MvTarjeta#TRANSACCION FOREIGN KEY (ID_TRANSACCION) REFERENCES TB_TRANSACCION (ID_TRANSACCION)
);
